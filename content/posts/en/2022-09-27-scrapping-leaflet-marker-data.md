---
title: 'Scrapping Leaflet Marker Data'
date: 2022-09-27T14:53:12+07:00
lastmod: 2022-10-03T14:21:00+07:00
tags: [snippet]
---

This is a snippet to scrap data from leaflet map generated by `https://sekolah.data.kemdikbud.go.id/index.php/Cpetasebaran/index/000000/`

```javascript
// Retrieve layers data as array
let layers = Object.keys(map._layers).map((key) => map._layers[key])

// Filter with popup only
let points = layers.filter((layer) => layer._popupHandlersAdded)

// Do something with the results
let results = points.map((point) => ({ coordinate: point.getLatLng(), data: point.getPopup().getContent() }))

// Extract essentials data
let processed = results.map((item) => {
  const element = document.createElement('div')
  element.innerHTML = item.data
  let data = element.querySelectorAll('li')
  data = [...data].map((el) => el.textContent.replace('NPSN : ', '').replace('Alamat : ', ''))

  return { coordinate: item.coordinate, npsn: data[0], nama: data[1], alamat: data[2] }
})

localStorage.setItem('results', JSON.stringify(processed))
```

Now we can retrieve the results from `localStorage`.
